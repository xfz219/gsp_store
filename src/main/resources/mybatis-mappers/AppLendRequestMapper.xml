<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.puhui.app.dao.AppLendRequestDao">
	<resultMap id="appLendRequestObj" type="appLendRequest" >
		<id property="id" column="id"/>
		<result property="appCustomerId" column="app_customer_id"/>
		<result property="customerServiceManagerNumber" column="customer_service_manager_number"/>
		<result property="state" column="state"/>
		<result property="auditState" column="audit_state"/>
		<result property="firstStartTime" column="first_start_time"/>
		<result property="startTime" column="start_time"/>
		<result property="endTime" column="end_time"/>
		<result property="approvalAmount" column="approval_amount"/>
		<result property="approvalLoanPeriod" column="approval_loan_period"/>
		<result property="approvalMonthlyRepay" column="approval_monthly_repay"/>
		<result property="createTime" column="create_time"/>
		<result property="loanAmount" column="loan_amount"/>
		<result property="dataCenterId" column="data_center_id"/>
		<result property="salesNo" column="sales_no"/>
		<result property="updateTime" column="update_time"/>
	</resultMap>
	<update id="updateCustomerEntryState" parameterType="map">
		update app_lend_request set
		state = #{state},audit_state = #{auditState}
		where id = #{id}
	</update>
	<update id="showChangeMobilePushDialog" parameterType="long">
		update app_lend_request set
		state = 2,audit_state = 0
		where id = #{id}
	</update>
	<delete id="showChangeMobileDelDialog" parameterType="long">
		DELETE FROM app_customer WHERE mobile = #{mobile, typeHandler=encryptTypeHandler}
	</delete>
	<delete id="showChangeMobileDelLoginDialog" parameterType="long">
		DELETE FROM app_customer_log_in WHERE mobile = #{mobile, typeHandler=encryptTypeHandler}
	</delete>
	<delete id="showChangeIdDelDialog" parameterType="long">
		DELETE FROM app_user_to_promote WHERE id = #{id}
	</delete>
	<select id="selectAppLendRequestMethod" parameterType="map"
		resultType="String">
		SELECT id FROM app_lend_request

		where app_customer_id in
		<foreach collection="ids" item="id" index="index" open="("
			close=")" separator=",">
			#{id}
		</foreach>
	</select>

	<update id="updateCustomerSalesNo" parameterType="map">
		update app_lend_request set customer_service_manager_number =
		#{salesId}
		where id in
		<foreach collection="ids" item="id" index="index" open="("
			close=")" separator=",">
			#{id}
		</foreach>
	</update>
	
	<select id="getAppLendRequestByCustomerId" parameterType="long" resultMap="appLendRequestObj">
		select id,state,audit_state,loan_amount,data_center_id,update_time from app_lend_request where app_customer_id = #{customerId} order by create_time desc limit 1
	</select>
	
	<select id="getAppUserToPromote"  resultType="map">
		SELECT id,city FROM app_user_to_promote WHERE create_time > '2017-01-06 00:00:00' AND (channel_two_type='QIANZHAN' OR channel_two_type = 'PAL')
	</select>
	
	<update id="updateAppUserToPromote" >
		update app_user_to_promote set branch = #{name},branch_code = #{code}
		where id = #{id}
	</update>

	<select id="questionnaireControl" resultType="boolean">
		select questionnaire from app_lend_request where id = #{id}
	</select>

	<update id="updateQuestionnaire" >
		update app_lend_request set questionnaire = #{questionnaire}
		where id = #{id}
	</update>
</mapper>